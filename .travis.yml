env:
  global:
  - AUTHOR_EMAIL=gambol99@gmail.com
  - REGISTRY_USERNAME=gambol99+rebotbuilder
  - REGISTRY=quay.io
  - secure: KRN3I4z2dUL6+8oTqi0OHfGSYlCzSkrSaA19VMJFYImewE1mU3iI7bati5i4HopPe75StamekZP79g+vjbWtFGMUyRKfkaNbciKrdS4zwo4MrORj1dFlM7ljd/2MFFjq//4uh9opozbbmqQc5javUdVduXVbU6TYr6tPjH74MhePhuiA/NW/oDlTSA3xmvBhmlX2zBJYws5uUB40T5yq7ZLKAdu50WUJ2q0zdQHJbX2nJbo5VOrVgfyfjr38RVfWa0009yvrcBqaAdcXIsnl6DlQlMQYad4cA3eegTxn+zplJvCT7D5JUmLjl0HI7qclJxmR4Oo78vRSpIyzJnTm5iYJ/f2HQHzht3micv+FeHJ5wNhn/JE39micClMPsWRaJ9rPAcKQLPggxnCb7+JBPP21UnIk2kRLA0WPYOIZvRplmtH9cOX8R0BrnK/lwVIFPWdh99ucxsic30i32eaNs4JHPYx5fuoko/4HoAO0mex/OXHrAqADh3ll2sTfgvawmwF5noEbwVuAseeZFlvNVbQaX6lQyqBFGrIke0UQHPgMHo1MrxBShWh++J/4UBLkPBCgJcewB5YySvkNaZ2zkHmJiNU2k9NUbMWAT+X64JZLZJCLWkoBdP0gD3irjlTR086pueWMWda0n4PKvGtuMikK60CHm4Ae+6UZvQSDa5s=
services:
- docker
language: go
go:
- 1.7
install:
- go get github.com/Masterminds/glide
script:
- make test
- if ([[ ${TRAVIS_BRANCH} == "master" ]] && [[ ${TRAVIS_PULL_REQUEST} != "true" ]])
  || [[ -n ${TRAVIS_TAG} ]]; then docker login -u ${REGISTRY_USERNAME} -p ${REGISTRY_TOKEN}
  -e ${AUTHOR_EMAIL} ${REGISTRY}; VERSION="latest" make docker-release; fi
before_deploy:
- NAME=GOOS=linux GOARCH=amd64 go build -o bin/vault-lego-linux-amd64
after_deploy:
- docker login -u ${REGISTRY_USERNAME} -p ${REGISTRY_TOKEN} -e ${AUTHOR_EMAIL} ${REGISTRY}
- VERSION=$TRAVIS_TAG make docker-release
deploy:
  provider: releases
  skip_cleanup: true
  on:
    repo: gambol99/vault-lego
    tags: true
  api_key:
    secure: Gcn1ggyZ96yeSAoBfMf5Gpkki4aCcDaJ0KcCnfLdvfs09iK174OUUgmNQPDJy53KlqzjBUcKCzKQ5BQde7O8LHuDF2yJLrUNqm4VRLPIdXt2dVkUWldwomk+RlMBbEhJdXuiqEMnpgpeGx0bU15xDlLA1w7sB7lNyaYVuOvr8abdhfinhO5vnT5XLeNTJ9byWU4lQbBThJmkLPtE6GTcuag04WuRcnNeV7tvnJb1R3m81i7mIUmTa2T3Xc2dpWX/IkGi8ROOcloEbQyMROyShGFVoMsGpTn9BlWaTt1RqXdlHSa8nJCiRSI2qOD9DnlD+g/xAIQbagUmh5N1nE4K+xKzkUXMfbAK3AkesnHI6unXSNA/e7C2Q8yyilP8sNcntzrkMoELxwGUCCfqbSp1wjMnPJw2zyzvuFKVlcneekPfmSHCJWNW4o/Y3qRAFaJSUYGhdf7KZ67hYEfr1CkjvrmpEbbNB/E8t1bMj6Fs6Yi++u2Y3CFj4fi3Pt8rGw2TcPb2q4fn3cr8gCri01mZz/UqdkKZegQgXwb7lhEmubmujgKM5ycbP+/1TnJ6Q0jisAaTcgcwb5lzenbM+euVdsRFqrZl8354aclbknw5bqVFTPngqzLRS/nKBqNqDI2iy6c6dmqRBS7csM0cCo84dME7qEYJQUM557YFVLylajw=
  file: bin/vault-lego-linux-amd64
